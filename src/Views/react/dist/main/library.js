import{MainContext as e}from"/jsx/context";import t from"/jsx/global/modal";import a from"/jsx/global/pdfviewer";import{React as l}from"/jsx/imports";export default function s(){const{authenticated:s,authData:c}=l.useContext(e),[r,o]=l.useState([]),[n,m]=l.useState(1),p=l.useMemo((()=>Math.ceil(r.length/20)),[r]),i=l.useMemo((()=>0===r.length?void 0:r?.slice(20*(n-1),Math.min(20*n))),[n,r,p]),x=l.useCallback((()=>m((e=>Math.min(p,Math.max(0===p?0:1,e+1))))),[p]),u=l.useCallback((()=>m((e=>Math.min(p,Math.max(0===p?0:1,e-1))))),[p]),h=async()=>{const e=new URL("/api/favorites/all",window.location.origin);e.searchParams.set(c?.account,c?.id);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const{success:a,error:l}=await t.json();if(l)throw new Error(`HTTP error: ${l.message}`);a&&o(a)}catch(e){console.log(e)}};l.useEffect((()=>{h().catch()}),[]);const[d,E]=l.useState(),[y,N]=l.useState(),[b,f]=l.useState(),w=l.useCallback(((e,t,a,l)=>{const s=new URL(`/read${t}&id=${e}`,window.location.origin).toString();N(a),E(s),f(l),setTimeout((()=>h().catch()),1e3)}),[h]);return l.createElement(l.Fragment,null,l.createElement("div",{className:"py-4 px-8 mt-4"},l.createElement("div",{className:"mt-3"},l.createElement("h1",{className:"text-2xl font-bold text-center mb-3"},"Library"),l.createElement("div",{className:"flex max-w-full overflow-auto"},l.createElement("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500 table-auto"},l.createElement("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50"},l.createElement("tr",null,l.createElement("th",{scope:"col",className:"px-6 py-3"},"Type"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Title"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Authors"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Year"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Publisher"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Published Date"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Department"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Course"),l.createElement("th",{scope:"col",className:"px-6 py-3"},"Read"))),l.createElement("tbody",{className:"bg-white border-b"},i?.map((e=>l.createElement("tr",{key:e.id+"_"+e.type,className:"bg-white border-b cursor-pointer hover:bg-sky-100",onClick:()=>w(e.id,e.url,e.title,e.author+" ("+e.year+")")},l.createElement("th",{scope:"row",className:"px-6 py-4"},e.type),l.createElement("td",{className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap"},e.title),l.createElement("td",{className:"px-6 py-4"},e.authors),l.createElement("td",{className:"px-6 py-4"},e.year),l.createElement("td",{className:"px-6 py-4"},e.publisher),l.createElement("td",{className:"px-6 py-4"},e.published_date),l.createElement("td",{className:"px-6 py-4"},e.department),l.createElement("td",{className:"px-6 py-4"},e.course),l.createElement("td",{className:"px-6 py-4 text-center"},e.read," times"))))||l.createElement("tr",null,l.createElement("td",{colSpan:8},l.createElement("div",{className:"h-[200px] mb-2 mx-auto text-center"},l.createElement("div",{className:"rounded-lg p-4"},l.createElement("div",{className:"text-gray-500"},"No favorites."))))))))),l.createElement("div",{className:"flex flex-col"},l.createElement("div",{className:"flex-shrink text-slate-700 font-[600] mx-auto"},l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:()=>m(0===p?0:1)},"<<"),l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:u},"<"," Prev"),l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:x},"Next ",">"),l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:()=>m(p)},">>")))),l.createElement(t,{open:!!d,onClose:()=>{E(void 0),N(void 0),f(void 0)},content:s?l.createElement(a,{src:d}):l.createElement("div",{className:"w-full text-center min-h-[150px] pt-16"},"Please ",l.createElement("a",{href:"/login",className:"text-sky-700 underline"},"login")," to view."),header:y,showCancelButton:!1,showConfirmButton:!1,footer:b}))}