import{MainContext as e}from"/jsx/context";import t from"/jsx/global/clsx";import{Departments as a}from"/jsx/global/enums";import o from"/jsx/global/modal";import r from"/jsx/global/pdfviewer";import{React as l,Sweetalert2 as n}from"/jsx/imports";import s from"/jsx/main/search";function c({id:t,title:a,abstract:o,author:r,course:s,year:c,favorite:i,url:m,onViewPdf:u,onRefresh:d}){const{authenticated:h,authData:p}=l.useContext(e),x=l.useCallback((e=>{e.preventDefault(),e.stopPropagation();const a=new URL("/api/thesis/markfavorite",window.location.origin),o=JSON.stringify({id:t,[p?.account]:p?.id});fetch(a,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},body:o}).then((e=>e.json())).then((({success:e,error:t})=>{t?n.fire({icon:"error",title:"Error",text:"Failed to mark thesis as favorite: "+t,toast:!0,showConfirmButton:!1,position:"center",timer:3e3}):e?d&&d():n.fire({icon:"error",title:"Error",text:"Failed to mark thesis as favorite",toast:!0,showConfirmButton:!1,position:"center",timer:3e3})})).catch(console.log)}),[t,p]),f=l.useCallback((()=>{const e=new URL(`/read${m}&id=${t}`,window.location.origin).toString();u&&u(e,a,r+" ("+c+")")}),[m,u,t]);return l.createElement(l.Fragment,null,l.createElement("div",{onClick:f,className:"text-center relative cursor-pointer border rounded-lg p-4 w-[400px]"},h&&l.createElement("button",{type:"button",onClick:x,className:"absolute right-2 top-3 z-20 hover:text-yellow-500"},i&&l.createElement("span",{className:"material-symbols-outlined text-green-700"},"bookmark_star"),!i&&l.createElement("span",{className:"material-symbols-outlined"},"bookmark")),l.createElement("div",{className:"h-[75px] pt-4 px-4 font-bold leading-tight"},a),l.createElement("div",{className:"h-[150px] mb-2 text-justify px-4 leading-tight indent-8"},o.substring(0,Math.min(320,o.length)),"..."),l.createElement("div",{className:"pt-4 px-2 leading-tight text-gray-700 italic"},r," (",c,")"),l.createElement("div",{className:"pb-2 px-2 text-sm italic leading-tight text-gray-600"},s)))}export default function i(){const{authenticated:n,authData:i}=l.useContext(e),[m,u]=l.useState(new URLSearchParams(new URL(window.location.href).search).get("search")||""),d=l.useMemo((()=>new URLSearchParams(new URL(window.location.href).search)),[]),h=l.useCallback((e=>{u(e),d.set("search",e),window.history.pushState({},"",`?${d.toString()}`)}),[]),[p,x]=l.useState([]),[f,g]=l.useState(a.CCIS),b=l.useMemo((()=>p.filter((e=>e.department===f&&(!m||e.title.includes(m))||e.abstract.includes(m)||e.author.includes(m)||e.year.toString().includes(m)))),[p,f,m]),[w,v]=l.useState(1),y=l.useMemo((()=>Math.ceil(b.length/20)),[b]),E=l.useMemo((()=>0===b.length?void 0:b?.slice(20*(w-1),20*w)),[w,b,y]),N=l.useCallback((()=>v((e=>Math.min(y,Math.max(0===y?0:1,e+1))))),[y]),k=l.useCallback((()=>v((e=>Math.min(y,Math.max(0===y?0:1,e-1))))),[y]),C=async()=>{const e=new URL("/api/thesis/public/all",window.location.origin);e.searchParams.set(i?.account,i?.id);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const{success:a,error:o}=await t.json();if(o)throw new Error(`HTTP error: ${o.message}`);a&&(a.sort(((e,t)=>new Date(e.created_at).getTime()>new Date(t.created_at).getTime()?-1:1)),x(a))}catch(e){console.log(e)}};l.useEffect((()=>{C().catch()}),[]);const[S,j]=l.useState(),[P,T]=l.useState(),[M,R]=l.useState(),U=l.useCallback(((e,t,a)=>{T(t),j(e),R(a)}),[]);return l.createElement(l.Fragment,null,l.createElement("div",{className:"flex py-4 px-8 mt-4"},l.createElement("div",{className:"flex-grow mt-3"},l.createElement("h1",{className:"text-2xl font-bold text-center"},"Theses/Capstone"),l.createElement("div",{className:"flex flex-wrap p-4 gap-4"},!!f&&E?.map((e=>l.createElement(c,{key:e.id,id:e.id,title:e.title,abstract:e.abstract,author:e.author,course:e.course,year:e.year,favorite:e.favorite,url:e.url,onViewPdf:U,onRefresh:C})))||l.createElement("div",{className:"lg:col-span-2 xl:col-span-3 mx-auto"},l.createElement("div",{className:"h-[200px] mb-2"},l.createElement("div",{className:"border-2 border-gray-300 rounded-lg p-4"},l.createElement("div",{className:"text-gray-500"},"No theses found.")))))),l.createElement("div",{className:"min-w-[326px] max-w-[326px] h-[600px] flex flex-col"},l.createElement("div",{className:"min-h-[400px] flex-grow"},l.createElement("div",{className:"font-bold text-xl mb-4 w-full"},"Categories"),Object.entries(a).map((([e,a])=>l.createElement("button",{key:e,type:"button",className:t("flex items-center px-4 py-2 text-left",f===a?"bg-gray-200 font-bold":"hover:bg-gray-300"),onClick:()=>g(a)},a)))),l.createElement("div",{className:"flex-shrink text-slate-700 font-[600] w-full mb-3"},l.createElement(s,{search:m,onSearch:h})),l.createElement("div",{className:"text-slate-700 font-[600] max-w-full overflow-x-auto overflow-y-hidden"},l.createElement("div",{className:"flex"},Array.from({length:y}).map(((e,a)=>l.createElement("button",{key:a,type:"button",className:t("flex items-center px-4 py-2 text-left",w===a+1?"bg-gray-200 font-bold":"hover:bg-gray-300"),onClick:()=>v(a+1)},a+1))))),l.createElement("div",{className:"flex-shrink text-slate-700 font-[600] mx-auto"},l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:()=>v(0===y?0:1)},"<<"),l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:k},"<"," Prev"),l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:N},"Next ",">"),l.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:()=>v(y)},">>")))),l.createElement(o,{open:!!S,onClose:()=>{j(void 0),T(void 0),R(void 0)},content:n?l.createElement(r,{src:S}):l.createElement("div",{className:"w-full text-center min-h-[150px] pt-16"},"Please ",l.createElement("a",{href:"/login",className:"text-sky-700 underline"},"login")," to view thesis."),header:P,showCancelButton:!1,showConfirmButton:!1,footer:M}))}