import{MainContext as e}from"/jsx/context";import t from"/jsx/global/clsx";import{Departments as a}from"/jsx/global/enums";import l from"/jsx/global/modal";import o from"/jsx/global/pdfviewer";import{React as r,Sweetalert2 as n}from"/jsx/imports";function s({id:t,title:a,abstract:l,author:o,course:s,year:i,favorite:c,url:m,publisher:u,publishedDate:p,onViewPdf:d,onRefresh:x}){const{authenticated:h,authData:f}=r.useContext(e),b=r.useCallback((e=>{e.preventDefault(),e.stopPropagation();const a=new URL("/api/journal/markfavorite",window.location.origin),l=JSON.stringify({id:t,[f?.account]:f?.id});fetch(a,{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},body:l}).then((e=>e.json())).then((({success:e,error:t})=>{t?n.fire({icon:"error",title:"Error",text:"Failed to mark journal as favorite: "+t,toast:!0,showConfirmButton:!1,position:"center",timer:3e3}):e?x&&x():n.fire({icon:"error",title:"Error",text:"Failed to mark journal as favorite",toast:!0,showConfirmButton:!1,position:"center",timer:3e3})})).catch(console.log)}),[t,f]),g=r.useCallback((()=>{const e=new URL(`/read${m}&id=${t}`,window.location.origin).toString();d&&d(e,a,o+" ("+i+")")}),[m,d,t]);return r.createElement(r.Fragment,null,r.createElement("div",{onClick:g,className:"text-center relative cursor-pointer border rounded-lg p-4 w-[400px]"},h&&r.createElement("button",{type:"button",onClick:b,className:"absolute right-2 top-3 z-20 hover:text-yellow-500"},c&&r.createElement("span",{className:"material-symbols-outlined text-green-700"},"bookmark_star"),!c&&r.createElement("span",{className:"material-symbols-outlined"},"bookmark")),r.createElement("div",{className:"h-[75px] pt-4 px-4 font-bold leading-tight"},a),r.createElement("div",{className:"h-[120px] mb-2 text-justify px-4 leading-tight indent-8"},l.substring(0,Math.min(250,l.length)),"..."),r.createElement("div",{className:"pt-4 px-2 leading-tight text-gray-700 italic"},o," (",i,")"),r.createElement("div",{className:"pb-2 px-2 text-sm italic leading-tight text-gray-600"},s),r.createElement("div",{className:"px-2 leading-tight text-gray-700 italic text-left"},"Publisher: ",u),r.createElement("div",{className:"pb-2 px-2 leading-tight text-gray-700 italic text-left"},"Published Date: ",new Date(p).toLocaleDateString())))}export default function i(){const{authenticated:n,authData:i}=r.useContext(e),[c,m]=r.useState([]),[u,p]=r.useState(a.CCIS),d=r.useMemo((()=>c.filter((e=>e.department===u))),[c,u]),[x,h]=r.useState(1),f=r.useMemo((()=>Math.ceil(d.length/20)),[d]),b=r.useMemo((()=>0===d.length?void 0:d?.slice(20*(x-1),20*x)),[x,d,f]),g=r.useCallback((()=>h((e=>Math.min(f,Math.max(0===f?0:1,e+1))))),[f]),v=r.useCallback((()=>h((e=>Math.min(f,Math.max(0===f?0:1,e-1))))),[f]),y=async()=>{const e=new URL("/api/journal/public/all",window.location.origin);e.searchParams.set(i?.account,i?.id);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const{success:a,error:l}=await t.json();if(console.log,l)throw new Error(`HTTP error: ${l.message}`);a&&m(a)}catch(e){console.log(e)}};r.useEffect((()=>{y().catch()}),[]);const[E,w]=r.useState(),[N,k]=r.useState(),[C,j]=r.useState(),P=r.useCallback(((e,t,a)=>{k(t),w(e),j(a)}),[]);return r.createElement(r.Fragment,null,r.createElement("div",{className:"flex py-4 px-8 mt-4"},r.createElement("div",{className:"flex-grow mt-3"},r.createElement("h1",{className:"text-2xl font-bold text-center"},"Journals"),r.createElement("div",{className:"flex flex-wrap p-4 gap-4"},!!u&&b?.map((e=>r.createElement(s,{key:e.id,id:e.id,title:e.title,abstract:e.abstract,author:e.author,course:e.course,year:e.year,favorite:e.favorite,url:e.url,publisher:e.publisher,publishedDate:e.published_date,onViewPdf:P,onRefresh:y})))||r.createElement("div",{className:"lg:col-span-2 xl:col-span-3 mx-auto"},r.createElement("div",{className:"h-[200px] mb-2"},r.createElement("div",{className:"border-2 border-gray-300 rounded-lg p-4"},r.createElement("div",{className:"text-gray-500"},"No theses found.")))))),r.createElement("div",{className:"min-w-[326px] max-w-[326px] h-[600px] flex flex-col"},r.createElement("div",{className:"min-h-[500px] flex-grow"},r.createElement("div",{className:"font-bold text-xl mb-4 w-full"},"Categories"),Object.entries(a).map((([e,a])=>r.createElement("button",{key:e,type:"button",className:t("flex items-center px-4 py-2 text-left",u===a?"bg-gray-200 font-bold":"hover:bg-gray-300"),onClick:()=>p(a)},a)))),r.createElement("div",{className:"flex-shrink text-slate-700 font-[600] max-w-full overflow-x-auto overflow-y-hidden"},r.createElement("div",{className:"flex"},Array.from({length:f}).map(((e,a)=>r.createElement("button",{key:a,type:"button",className:t("flex items-center px-4 py-2 text-left",x===a+1?"bg-gray-200 font-bold":"hover:bg-gray-300"),onClick:()=>h(a+1)},a+1))))),r.createElement("div",{className:"flex-shrink text-slate-700 font-[600] mx-auto"},r.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:()=>h(0===f?0:1)},"<<"),r.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:v},"<"," Prev"),r.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:g},"Next ",">"),r.createElement("button",{type:"button",className:"p-1 hover:text-yellow-700",onClick:()=>h(f)},">>")))),r.createElement(l,{open:!!E,onClose:()=>{w(void 0),k(void 0),j(void 0)},content:n?r.createElement(o,{src:E}):r.createElement("div",{className:"w-full text-center min-h-[150px] pt-16"},"Please ",r.createElement("a",{href:"/login",className:"text-sky-700 underline"},"login")," to view journal."),header:N,showCancelButton:!1,showConfirmButton:!1,footer:C}))}