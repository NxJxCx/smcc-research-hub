import e from"/jsx/admin/adddownloadable";import{CellAlign as t,Table as o,TableCellType as l,TableRowAction as a}from"/jsx/admin/table";import{React as n,Sweetalert2 as i}from"/jsx/imports";const r=[{label:"#",key:"id",sortable:!0,filterable:!0,cellType:l.Number,align:t.Center},{label:"File Title",key:"title",sortable:!0,cellType:l.String,align:t.Center},{label:"File Name",key:"name",sortable:!0,cellType:l.String,align:t.Center},{label:"Date Created",key:"created_at",sortable:!0,cellType:l.Date,align:t.Center},{label:"Downloadable?",key:"downloadable",sortable:!0,cellType:l.Custom,align:t.Center},{label:"Action",key:"action",sortable:!1,cellType:l.Custom,align:t.Center}];export default function s(){const[t,l]=n.useState(!1),[s,d]=n.useState([]),c=()=>{fetch("/api/downloadables/all").then((e=>e.json())).then((({success:e,error:t})=>{t?console.log(t):e&&d(e.map((e=>({id:e.id,created_at:e.created_at,title:e.title,name:e.name+e.ext,downloadable:{value:e.downloadable?"Yes":"No",content:e.downloadable?n.createElement("button",{type:"button",className:"bg-white px-3 py-2 text-green-700 font-bold rounded-2xl leading-[14.63px] text-[12px]",onClick:()=>{i.fire({icon:"question",title:"Do you want to make this file unavailable for download?",confirmButtonText:"Yes, make it unavailable for download",confirmButtonColor:"#3085d6",showDenyButton:!0,denyButtonText:"No, Cancel",denyButtonColor:"#d33",showLoaderOnConfirm:!0,preConfirm:async()=>{try{const t=new URL("/api/downloadables/publish",window.location.origin),o=await fetch(t,{method:"POST",body:JSON.stringify({id:e.id,downloadable:!1}),headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!o.ok){const{error:e}=await o.json();return i.showValidationMessage("Failed: "+e)}return o.json()}catch(e){i.showValidationMessage("Failed: "+e)}},allowOutsideClick:()=>!i.isLoading()}).then((e=>{e.isConfirmed&&(e.value?.error?i.fire({icon:"error",title:"Error",text:"Failed to make this file unavailable for download: "+e.value.error,timer:3e3,toast:!0,position:"center"}):(i.fire({icon:"success",title:"File made unavailable for download",timer:3e3,toast:!0,position:"center"}),c()))}))}},"Yes"):n.createElement("button",{type:"button",className:"bg-white px-3 py-2 text-red-500 rounded-2xl font-[500] leading-[14.63px] text-[12px]",onClick:()=>{i.fire({icon:"question",title:"Do you want this file to be available for download?",confirmButtonText:"Yes, make it available",confirmButtonColor:"#3085d6",showDenyButton:!0,denyButtonText:"No, Cancel",denyButtonColor:"#d33",showLoaderOnConfirm:!0,preConfirm:async()=>{try{const t=new URL("/api/downloadables/publish",window.location.origin),o=await fetch(t,{method:"POST",body:JSON.stringify({id:e.id,downloadable:!0}),headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!o.ok){const{error:e}=await o.json();return i.showValidationMessage("Failed: "+e)}return o.json()}catch(e){i.showValidationMessage("Failed: "+e)}},allowOutsideClick:()=>!i.isLoading()}).then((e=>{e.isConfirmed&&(e.value?.error?i.fire({icon:"error",title:"Error",text:"Failed to make file available for download: "+e.value.error,timer:3e3,toast:!0,position:"center"}):(i.fire({icon:"success",title:"File made available for download",timer:3e3,toast:!0,position:"center"}),c()))}))}},"No")},action:n.createElement(a,{id:e.id,onDownload:t=>{if(t===e.id){const t=window.open(new URL(`/download${e.url}`,window.location.origin),"_blank");setTimeout((()=>{t&&t.close()}),1e3)}},onDelete:e=>{i.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete downloadable file!"}).then((({isConfirmed:t})=>{t&&fetch(`/api/downloadables/delete?id=${e}`,{method:"DELETE"}).then((e=>e.json())).then((({success:e,error:t})=>{e?(c(),i.fire({icon:"success",title:"Deleted!",text:"Downloadable File has been deleted successfully.",timer:3e3})):(console.log(t),i.fire({icon:"error",title:"Error",text:"Failed to delete Downloadable File: "+t,confirmButtonText:"Try Again"}))})).catch((e=>{console.log(e),i.fire({icon:"error",title:"Error",text:"Failed to delete Downloadable File",timer:3e3})}))}))}})}))))})).catch((e=>{console.log(e),i.fire({icon:"error",title:"Error",text:"Failed to fetch Downloadable File list",confirmButtonText:"Try Again",showCancelButton:!0}).then((({isConfirmed:e})=>{e&&setTimeout((()=>c()),50)}))}))};return n.useEffect((()=>{c()}),[]),n.createElement("div",{className:"w-full min-h-[calc(100vh-160px)] h-fit bg-[#37414e] p-4 min-w-fit"},n.createElement("h1",{className:"text-white text-2xl my-2"},"Downloadable List"),n.createElement(o,{columns:r,items:s},n.createElement("div",{className:"px-4"},n.createElement("button",{type:"button",onClick:()=>c(),className:"hover:text-yellow-500",title:"Refresh List"},n.createElement("span",{className:"material-symbols-outlined"},"refresh"))),n.createElement("div",{className:"px-4"},n.createElement("button",{type:"button",onClick:()=>l(!0),className:"hover:text-yellow-500",title:"Add Thesis"},n.createElement("span",{className:"material-symbols-outlined"},"add"))),n.createElement(e,{open:t,onClose:()=>l(!1),onSuccess:()=>c(),className:"absolute right-3 top-full mt-4 shadow-lg"})))}