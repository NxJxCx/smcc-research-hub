import e from"/jsx/global/clsx";import{Input as t,Select as a}from"/jsx/global/input";import l from"/jsx/global/modal";import r from"/jsx/global/pdfviewer";import{React as n,Sweetalert2 as o}from"/jsx/imports";export default function s({open:s,defaultOpen:i,className:m="",onClose:c=()=>{}}){const[u,d]=n.useState(void 0===s?i||!1:s),[p,f]=n.useState(""),[x,h]=n.useState(""),[b,g]=n.useState((new Date).getFullYear().toString()),[w,E]=n.useState(),[v,y]=n.useState(),[N,C]=n.useState(!1),k=n.useMemo((()=>Array.from({length:(new Date).getFullYear()-2e3},((e,t)=>(new Date).getFullYear()-t)).map((e=>({label:e.toString(),value:e.toString()})))),[]);n.useEffect((()=>{void 0!==s&&(d(s),s||c&&c())}),[s]);const j=n.useCallback((()=>{void 0===s&&d(!1),c&&c()}),[s,c]),F=n.useCallback((()=>{w&&C(!0)}),[w]);n.useEffect((()=>{if(w){const e=new Blob([w],{type:w.type}),t=URL.createObjectURL(e);return y(t),()=>{URL.revokeObjectURL(t),y(null)}}}),[w]);const S=n.useCallback((e=>{if(e.preventDefault(),!w)return void o.fire({icon:"warning",text:"Please upload Thesis Document in PDF format.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"});const t=new FormData;t.append("document","thesis"),t.append("title",p),t.append("author",x),t.append("year",b),t.append("pdf",new Blob([w],{type:"application/pdf"}),w.name),fetch("/api/upload/pdf",{method:"POST",body:t}).then((e=>e.json())).then((({error:e,success:t})=>{e?o.fire({icon:"error",title:"Error",text:e,toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}):(console.log(t),o.fire({icon:"success",title:"Success",text:"Thesis Document uploaded successfully.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),E(null),f(""),h(""),g((new Date).getFullYear().toString()))})).catch((e=>{o.fire({icon:"error",title:"Error",text:"Failed to upload PDF file:"+e.message,toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),console.log(e)}))}),[w,p,x,b]);return n.createElement(n.Fragment,null,n.createElement("div",{className:e("max-w-[500px] min-w-[400px] bg-[#252e38] pt-4 px-4 rounded-lg border border-[#45515F] z-20",u?"block":"hidden",m)},n.createElement("form",{onSubmit:S},n.createElement("div",{className:"flex flex-wrap justify-center items-center gap-3"},n.createElement(t,{className:"max-w-[180px] text-black",label:"Thesis Title",name:"title",value:p,onChange:e=>f(e.target.value),required:!0}),n.createElement(t,{className:"max-w-[180px] text-black",label:"Author/s",name:"author",value:x,onChange:e=>h(e.target.value),required:!0}),n.createElement(a,{className:"max-w-[180px] text-black",items:k,label:"Year",name:"year",value:b,onChange:e=>g(e.target.value),required:!0})),n.createElement("div",{className:"flex items-center justify-center w-full px-4 mt-4"},n.createElement("label",{htmlFor:"dropzone-file",className:e("flex flex-col items-center justify-center w-full h-32 border border-gray-500 border-dashed rounded-lg cursor-pointer",w?"hidden":"")},n.createElement("div",{className:"flex flex-col items-center justify-center"},n.createElement("svg",{className:"w-8 h-8 mb-4 text-gray-500","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16"},n.createElement("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"})),n.createElement("p",{className:"mb-2 text-sm text-white"},n.createElement("span",{className:"font-semibold"},"Click to upload")," or drag and drop"),n.createElement("p",{className:"text-xs text-gray-500"},"PDF (MAX 10MB)")),n.createElement("input",{id:"dropzone-file",type:"file",name:"pdf",className:"hidden",accept:".pdf",value:"",onChange:e=>{const t=e.target.files?.[0];t&&t.size>31457280?(o.fire({icon:"warning",text:"File size exceeds the maximum limit of 10MB.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),e.target.value=""):E(t)}})),!!w&&n.createElement("div",{className:"border border-gray-500 border-dashed p-4 rounded-lg w-full h-32 flex items-center justify-center"},n.createElement("div",{className:"flex justify-between border border-white p-3 rounded gap-x-3 items-center"},n.createElement("span",{className:"text-white material-symbols-outlined"},"upload_file"),n.createElement("button",{type:"button",onClick:F},n.createElement("span",{className:"text-md text-white"},w.name)),n.createElement("div",null,n.createElement("span",{className:"text-md text-gray-500"},(w.size/1024/1024).toFixed(2)," MB")),n.createElement("div",null,n.createElement("button",{type:"button",onClick:()=>E(null),className:"hover:text-red-600 text-red-400",title:"Remove"},n.createElement("span",{className:"material-symbols-outlined"},"cancel")))))),n.createElement("div",{className:"w-full py-2 flex justify-between items-center mt-2 px-4"},n.createElement("button",{type:"submit",className:"bg-sky-500 rounded-2xl px-4 py-1 text-white shadow-lg"},"Submit"),n.createElement("button",{type:"reset",onClick:j,className:"bg-[#333D49] rounded-2xl px-4 py-1 text-white"},"Cancel")))),n.createElement(l,{open:N,content:n.createElement(r,{src:v}),onClose:()=>C(!1),showCancelButton:!1,showConfirmButton:!1,header:`Thesis File Preview (${w?.name})`}))}