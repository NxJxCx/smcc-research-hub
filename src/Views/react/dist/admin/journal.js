import e from"/jsx/admin/addjournal";import{CellAlign as t,Table as l,TableCellType as o,TableRowAction as r}from"/jsx/admin/table";import a from"/jsx/global/modal";import n from"/jsx/global/pdfviewer";import{React as i,Sweetalert2 as s}from"/jsx/imports";const c=[{label:"#",key:"id",sortable:!0,filterable:!0,cellType:o.Number,align:t.Center},{label:"Date Created",key:"created_at",sortable:!0,cellType:o.Date,align:t.Center},{label:"Title",key:"title",sortable:!0,cellType:o.String,align:t.Center},{label:"Author",key:"author",sortable:!0,cellType:o.String,align:t.Center},{label:"Year",key:"year",sortable:!0,cellType:o.Number,align:t.Center},{label:"Department",key:"department",sortable:!0,cellType:o.String,align:t.Center},{label:"Course",key:"course",sortable:!0,cellType:o.String,align:t.Center},{label:"Published",key:"published",sortable:!0,cellType:o.Custom,align:t.Center},{label:"Action",key:"action",sortable:!1,cellType:o.Custom,align:t.Center}];function u(){const[t,o]=i.useState(!1),[u,m]=i.useState(""),[d,p]=i.useState(""),[b,h]=i.useState(""),[y,f]=i.useState([]),g=()=>{fetch("/api/journal/all").then((e=>e.json())).then((({success:e,error:t})=>{t?console.log(t):f(e.map((e=>({id:e.id,created_at:e.created_at,title:e.title,author:e.author,year:e.year,department:e.department,course:e.course,published:{value:e.published_id?new Date(e.fk_published_id.created_at).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):1,content:e.published_id?i.createElement("button",{type:"button",className:"bg-white px-3 py-2 text-green-500 rounded-2xl font-[500] leading-[14.63px] text-[12px]",disabled:!0},new Date(e.fk_published_id.created_at).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})):i.createElement("button",{type:"button",className:"bg-white px-3 py-2 text-red-500 rounded-2xl font-[500] leading-[14.63px] text-[12px]"},"Unpublished")},action:i.createElement(r,{id:e.id,onView:t=>{t===e.id&&(p(e.title),h("Author/s: "+e.author+" ("+e.year+")"),m(new URL(`/read${e.url}`,window.location.origin).toString()))},onDelete:e=>{s.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete journal!"}).then((({isConfirmed:t})=>{t&&fetch(`/api/journal/delete?id=${e}`,{method:"DELETE"}).then((e=>e.json())).then((({success:e,error:t})=>{e?(g(),s.fire({icon:"success",title:"Deleted!",text:"Journal has been deleted successfully.",timer:3e3})):(console.log(t),s.fire({icon:"error",title:"Error",text:"Failed to delete thesis: "+t,confirmButtonText:"Try Again"}))})).catch((e=>{console.log(e),s.fire({icon:"error",title:"Error",text:"Failed to delete journal",timer:3e3})}))}))}})}))))})).catch((e=>{console.log(e),s.fire({icon:"error",title:"Error",text:"Failed to fetch journal list",confirmButtonText:"Try Again",showCancelButton:!0}).then((({isConfirmed:e})=>{e&&setTimeout((()=>g()),50)}))}))};return i.useEffect((()=>{u||(p(""),h(""))}),[u]),i.useEffect((()=>{g()}),[]),i.createElement("div",{className:"w-full min-h-[calc(100vh-160px)] h-fit bg-[#37414e] p-4 "},i.createElement("h1",{className:"text-white text-2xl my-2"},"Journal List"),i.createElement(l,{columns:c,items:y},i.createElement("div",{className:"px-4"},i.createElement("button",{type:"button",onClick:()=>g(),className:"hover:text-yellow-500",title:"Refresh List"},i.createElement("span",{className:"material-symbols-outlined"},"refresh"))),i.createElement("div",{className:"px-4"},i.createElement("button",{type:"button",onClick:()=>o(!0),className:"hover:text-yellow-500",title:"Add Journal"},i.createElement("span",{className:"material-symbols-outlined"},"add"))),i.createElement(e,{open:t,onClose:()=>o(!1),onSuccess:()=>g(),className:"absolute right-3 top-full mt-4 shadow-lg"})),i.createElement(a,{open:!!u,onClose:()=>m(null),content:i.createElement(n,{src:u}),header:d,showCancelButton:!1,showConfirmButton:!1,footer:b}))}export default u;