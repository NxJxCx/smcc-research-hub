import{CellAlign as e,Table as a,TableCellType as t,TableRowAction as l}from"/jsx/admin/table";import{Departments as r}from"/jsx/global/enums";import{Input as n,Select as o}from"/jsx/global/input";import c from"/jsx/global/modal";import{React as s,Sweetalert2 as i}from"/jsx/imports";const m=[{label:"Teacher ID",key:"personnel_id",sortable:!0,filterable:!0,cellType:t.Number,align:e.Center},{label:"Full Name",key:"full_name",sortable:!0,cellType:t.String,align:e.Center},{label:"Email Address",key:"email",sortable:!0,cellType:t.String,align:e.Center},{label:"Department",key:"department",sortable:!0,cellType:t.String,align:e.Center},{label:"Date Registered",key:"created_at",sortable:!0,cellType:t.Date,align:e.Center},{label:"Action",key:"action",sortable:!1,cellType:t.Custom,align:e.Center}];function u({formData:e,onChange:a}){return s.createElement("div",{className:"p-8"},s.createElement(n,{label:"Employee ID",borderColor:"border-black",className:"mb-2",labelColor:"black",name:"personnel_id",placeholder:"Employee ID",value:e.username,onChange:t=>a({...e,username:t.target.value}),required:!0}),s.createElement(n,{label:"Full Name",borderColor:"border-black",className:"mb-2",labelColor:"black",name:"full_name",placeholder:"Full Name",value:e.full_name,onChange:t=>a({...e,full_name:t.target.value}),required:!0}),s.createElement(n,{type:"email",label:"Email Address",borderColor:"border-black",className:"mb-2",labelColor:"black",name:"email",placeholder:"Email Address",value:e.email,onChange:t=>a({...e,email:t.target.value}),required:!0}),s.createElement(o,{labelColor:"black",items:Object.entries(r).map((([e,a])=>({label:a,value:a}))),label:"Department",name:"department",placeholder:"Department",value:e.department,onChange:t=>a({...e,department:t.target.value}),required:!0}))}function d({formData:e,onChange:a}){return s.createElement("div",{className:"p-8"},s.createElement(n,{disabled:!0,label:"Employee ID",inputClassName:"border-black",className:"mb-2",labelColor:"black",name:"edit_personnel_id",placeholder:"Employee ID",value:e.username,onChange:t=>a({...e,username:t.target.value})}),s.createElement(n,{label:"Full Name",inputClassName:"border-black",className:"mb-2",labelColor:"black",name:"edit_full_name",placeholder:"Full Name",value:e.full_name,onChange:t=>a({...e,full_name:t.target.value}),required:!0}),s.createElement(n,{type:"email",label:"Email Address",inputClassName:"border-black",className:"mb-2",labelColor:"black",name:"edit_email",placeholder:"Email Address",value:e.email,onChange:t=>a({...e,email:t.target.value}),required:!0}),s.createElement(o,{labelColor:"black",items:Object.entries(r).map((([e,a])=>({label:a,value:a}))),label:"Department",name:"edit_department",placeholder:"Department",value:e.department,onChange:t=>a({...e,department:t.target.value}),required:!0}),s.createElement(n,{type:"password",label:"Password",inputClassName:"border-black",className:"mb-2",labelColor:"black",name:"edit_password",placeholder:"Password (Leave blank if not change)",value:e.password,onChange:t=>a({...e,password:t.target.value})}))}export default function p(){const[e,t]=s.useState([]),[n,o]=s.useState({account:"personnel",username:"",full_name:"",email:"",password:"",department:r.CCIS}),p=s.useCallback((()=>{o({account:"personnel",username:"",full_name:"",email:"",password:"",department:r.CCIS})}),[]),[b,h]=s.useState(!1),f=s.useCallback((e=>{o({account:"personnel",username:e.personnel_id,full_name:e.full_name,email:e.email,password:"",department:e.department}),h(!0)}),[]),C=()=>{fetch("/api/teacher/all").then((e=>e.json())).then((({success:e,error:a})=>{a?console.log(a):t(e.map((e=>({id:e.personnel_id,personnel_id:e.personnel_id,created_at:e.created_at,full_name:e.full_name,email:e.email,department:e.department,action:s.createElement(l,{id:e.personnel_id,onEdit:a=>{a===e.personnel_id&&f(e)},onDelete:e=>{i.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete teacher account!"}).then((({isConfirmed:a})=>{a&&fetch(`/api/teacher/delete?id=${e}`,{method:"DELETE"}).then((e=>e.json())).then((({success:e,error:a})=>{e?(C(),i.fire({icon:"success",title:"Deleted!",text:"Teacher account has been deleted successfully.",timer:3e3})):(console.log(a),i.fire({icon:"error",title:"Error",text:"Failed to delete teacher account: "+a,confirmButtonText:"Try Again"}))})).catch((e=>{console.log(e),i.fire({icon:"error",title:"Error",text:"Failed to delete teacher account",timer:3e3})}))}))}})}))))})).catch((e=>{console.log(e),i.fire({icon:"error",title:"Error",text:"Failed to fetch teacher list",confirmButtonText:"Try Again",showCancelButton:!0}).then((({isConfirmed:e})=>{e&&setTimeout((()=>C()),50)}))}))};s.useEffect((()=>{C()}),[]);const g=s.useCallback((async e=>{try{const a=await fetch("/api/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=await a.json();t.success?(e(),p(),i.fire({icon:"success",title:"Success",text:"Teacher account has been updated successfully.",timer:3e3}),setTimeout((()=>C()),100)):i.fire({icon:"error",title:"Failed",text:t.error})}catch(a){console.log(a),i.fire({icon:"error",title:"Error",text:"Failed to update teacher account",confirmButtonText:"Try Again",showCancelButton:!0}).then((({isConfirmed:a})=>{a&&setTimeout((()=>g(e)),100)}))}}),[n]),[E,y]=s.useState(!1),T=s.useCallback((async e=>{try{const a=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,password:n.full_name.replace(" ","").trim().substring(0,3).toLowerCase()+n.username})}),t=await a.json();t.success?(e(),p(),i.fire({icon:"success",title:"Success",text:"Teacher account has been added successfully.",timer:3e3}),setTimeout((()=>C()),100)):i.fire({icon:"error",title:"Failed",text:t.error})}catch(a){console.log(a),i.fire({icon:"error",title:"Error",text:"Failed to add teacher account",confirmButtonText:"Try Again",showCancelButton:!0}).then((({isConfirmed:a})=>{a&&setTimeout((()=>T(e)),100)}))}}),[n]);return s.createElement(s.Fragment,null,s.createElement("div",{className:"w-full min-h-[calc(100vh-160px)] h-fit bg-[#37414e] p-4 min-w-fit"},s.createElement("h1",{className:"text-white text-2xl my-2"},"Teacher List"),s.createElement(a,{columns:m,items:e},s.createElement("div",{className:"px-4"},s.createElement("button",{type:"button",onClick:()=>C(),className:"hover:text-yellow-500",title:"Refresh List"},s.createElement("span",{className:"material-symbols-outlined"},"refresh"))),s.createElement("div",{className:"px-4"},s.createElement("button",{type:"button",onClick:()=>y(!0),className:"hover:text-yellow-500",title:"Add Teacher Account"},s.createElement("span",{className:"material-symbols-outlined"},"add"))))),s.createElement(c,{open:E,header:"Add Teacher Account",content:s.createElement(u,{formData:n,onChange:o}),onConfirm:T,onCancel:p,onClose:()=>y(!1)}),s.createElement(c,{open:b,header:"Edit Teacher Account",content:s.createElement(d,{formData:n,onChange:o}),onConfirm:g,onCancel:p,onClose:()=>h(!1)}))}