import e from"/jsx/global/clsx";import{Input as t}from"/jsx/global/input";import{React as l,Sweetalert2 as a}from"/jsx/imports";export default function r({open:r,defaultOpen:o,className:n="",onClose:s=()=>{},onSuccess:i=()=>{}}){const[c,m]=l.useState(void 0===r?o||!1:r),[d,u]=l.useState(""),[p,x]=l.useState(),[f,b]=l.useState(0),[h,g]=l.useState(null),w=l.useMemo((()=>0!==f),[f]);l.useEffect((()=>{void 0!==r&&(m(r),r||s&&s())}),[r]);const E=l.useCallback((()=>{void 0===r&&m(!1),s&&s()}),[r,s]),y=l.useCallback((e=>{if(e.preventDefault(),!p)return void a.fire({icon:"warning",text:"Please upload Thesis Document in PDF format.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"});const t=new FormData;t.append("title",d),t.append("file",new Blob([p],{type:p.type}),p.name);const l=new XMLHttpRequest;g(l),l.open("POST","/api/upload/file",!0),l.upload.onprogress=e=>{if(e.lengthComputable){const t=e.loaded/e.total*100;b(t)}},l.onload=()=>{if(201===l.status){const e=JSON.parse(l.responseText);e.error?(a.fire({icon:"error",title:"Failed to upload PDF file",text:e.error,toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),b(0)):(a.fire({icon:"success",title:"Success",text:"Thesis Document uploaded successfully.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),x(null),u(""),i&&i(),b(0),E())}else a.fire({icon:"error",title:"Failed to upload PDF file",text:JSON.parse(l.responseText)?.error,toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),b(0)},l.onerror=e=>{a.fire({icon:"error",title:"Failed to upload PDF file",text:JSON.parse(l.responseText)?.error,toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),b(0)},l.send(t)}),[p,d,i,E]),N=()=>{h&&(h.abort(),b(0),g(null),a.fire({icon:"info",title:"Upload Cancelled",text:"The file upload has been cancelled.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}))};return l.createElement(l.Fragment,null,l.createElement("div",{className:e("max-w-[500px] min-w-[400px] bg-[#252e38] pt-4 px-4 rounded-lg border border-[#45515F] z-20",c?"block":"hidden",n)},l.createElement("form",{onSubmit:y},l.createElement("div",{className:"flex flex-wrap justify-center items-center gap-3"},l.createElement(t,{className:"max-w-[350px] text-black",label:"File Title",name:"title",value:d,onChange:e=>u(e.target.value),disabled:w,required:!0})),l.createElement("div",{className:"flex items-center justify-center w-full px-4 mt-4"},l.createElement("label",{htmlFor:"dropzone-file",className:e("flex flex-col items-center justify-center w-full h-32 border border-gray-500 border-dashed rounded-lg cursor-pointer",p?"hidden":"")},l.createElement("div",{className:"flex flex-col items-center justify-center"},l.createElement("svg",{className:"w-8 h-8 mb-4 text-gray-500","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 16"},l.createElement("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"})),l.createElement("p",{className:"mb-2 text-sm text-white"},l.createElement("span",{className:"font-semibold"},"Click to upload")," or drag and drop"),l.createElement("p",{className:"text-xs text-gray-500 px-4 text-center"},"PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, ODT, TXT, PNG, JPEG, GIF (MAX 10MB)")),l.createElement("input",{id:"dropzone-file",type:"file",name:"file",className:"hidden",accept:".pdf, .doc, .docx, .xls, .xlsx, .ppt, .pptx, .odt, .txt, .png, .jpg, .jpeg, .gif",value:"",onChange:e=>{const t=e.target.files?.[0];t&&t.size>31457280?(a.fire({icon:"warning",text:"File size exceeds the maximum limit of 30MB.",toast:!0,timer:2e3,showConfirmButton:!1,position:"center"}),e.target.value=""):x(t)}})),!!p&&l.createElement("div",{className:"border border-gray-500 border-dashed p-4 rounded-lg w-full h-32 flex items-center justify-center"},l.createElement("div",{className:"flex justify-between border border-white p-3 rounded gap-x-3 items-center"},l.createElement("span",{className:"text-white material-symbols-outlined"},"upload_file"),l.createElement("button",{type:"button"},l.createElement("span",{className:"text-md text-white"},p.name)),l.createElement("div",null,l.createElement("span",{className:"text-md text-gray-500"},(p.size/1024/1024).toFixed(2)," MB")),l.createElement("div",null,l.createElement("button",{type:"button",onClick:()=>x(null),disabled:w,className:"disabled:text-gray-500 disabled:hover:text-gray-500  disabled:cursor-not-allowed hover:text-red-600 text-red-400",title:"Remove"},l.createElement("span",{className:"material-symbols-outlined"},"cancel")))))),f>0&&l.createElement("div",{className:"w-full px-4 mt-4"},l.createElement("div",{className:"w-full bg-gray-200 rounded-full h-2.5"},l.createElement("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${f}%`}})),l.createElement("p",{className:"text-white text-center mt-2"},f.toFixed(2),"%"),l.createElement("button",{type:"button",onClick:N,className:"bg-red-500 rounded-2xl px-4 py-1 text-white shadow-lg mt-2"},"Cancel Upload")),l.createElement("div",{className:"w-full py-2 flex justify-between items-center mt-2 px-4"},l.createElement("button",{type:"submit",disabled:w,className:"bg-sky-500 rounded-2xl px-4 py-1 text-white shadow-lg disabled:cursor-not-allowed disabled:bg-gray-400"},w?"Submitting...":"Submit"),l.createElement("button",{type:"reset",onClick:()=>{w?(N(),E()):E()},className:"bg-[#333D49] rounded-2xl px-4 py-1 text-white"},"Cancel")))))}