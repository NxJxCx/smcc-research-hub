import{Courses as e,Departments as t,IDRegExFormat as r,Year as a}from"/jsx/global/enums";import l from"/jsx/global/smcclogo";import{React as o,Sweetalert2 as s}from"/jsx/imports";import n from"/jsx/qrscan";function i(){const i=o.useMemo((()=>new URLSearchParams(window.location.search)),[window.location.search]),{student_id:c,full_name:d}=o.useMemo((()=>({student_id:i.get("student_id"),full_name:i.get("full_name")})),[i]),m=o.useMemo((()=>!r.studentId.test(c)||!r.studentName.test(d)),[c,d]),[u,p]=o.useState(!1),[f,g]=o.useState(""),[x,b]=o.useState(""),[y,h]=o.useState(""),[w,E]=o.useState(""),[v,N]=o.useState(""),[C,S]=o.useState(""),[k,j]=o.useState(!1),[q,_]=o.useState({password:""}),R=o.useMemo((()=>m||!f||!x||!w||!v||!C),[m,f,x,w,v,C]),B=o.useCallback((()=>{b(""),h("")}),[]),D=o.useCallback(((e,t)=>{t&&(p(!0),fetch(`/api/student?q=exist&id=${t}`).then((e=>e.json())).then((({error:r,exists:a})=>{r?s.fire({icon:"error",title:"Error",text:"Failed to check student existence: "+r,toast:!0,showConfirmButton:!1,position:"center",timer:3e3}):a?s.fire({icon:"error",title:"Error",text:"Student ID is already registered",timer:2e3,toast:!0,position:"center",showConfirmButton:!1}).then((()=>{s.fire({icon:"question",text:"Do you want to login instead?",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No"}).then((({isConfirmed:e})=>{e&&window.location.replace(`/login?student_id=${t}`)}))})):window.location.replace(`/signup?student_id=${t}&full_name=${e}`)})).catch((e=>{s.fire({icon:"error",title:"Error",text:"Failed to retrieve student information:"+e.message,toast:!0,showConfirmButton:!1,position:"center",timer:3e3})})).finally((()=>setTimeout((()=>p(!1)),1e3))))}),[]),F=o.useCallback((e=>{if(e.preventDefault(),j(!0),x!==y)return _({password:"Passwords do not match"}),s.fire({icon:"error",title:"Error",text:"Passwords do not match",toast:!0,showConfirmButton:!1,position:"center",timer:3e3}),void j(!1);fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},body:JSON.stringify({account:"student",username:c,full_name:d,email:f,department:w,course:v,year:C,password:x})}).then((e=>e.json())).then((({error:e,success:t})=>{e?(s.fire({icon:"error",title:"Error",text:e,toast:!0,showConfirmButton:!1,position:"center",timer:3e3}),console.log(e)):t&&(B(),s.fire({icon:"success",title:"Registration Successful",text:"You have been registered successfully. Please login.",toast:!0,showConfirmButton:!1,position:"center",timer:2e3}).then((()=>{window.location.href="/login"})))})).catch((e=>{s.fire({icon:"error",title:"Error",text:"Failed to login. Please try again."}),console.log(e)})).finally((()=>{b(""),j(!1)}))}),[c,f,v,C,x,y]);return m?o.createElement("div",{className:"w-full pt-16 relative"},o.createElement("button",{type:"button",onClick:()=>window.location.replace("/"),className:"absolute top-0 left-0 ml-4 mt-4 text-sky-500 hover:text-sky-3 bg-white drop-shadow-lg pl-2 pr-3 py-1 rounded flex items-center"},o.createElement("span",{className:"material-symbols-outlined"},"arrow_left")," Home"),o.createElement("div",{className:"p-4"},o.createElement("div",{className:"max-w-md mx-auto flex flex-col gap-8 border border-sky-300 rounded-lg p-8 shadow-lg pt-10"},o.createElement(l,{className:"w-[100px] aspect-square mx-auto"}),o.createElement("div",{className:"text-[24px] font-[700] text-center"},"Student Registration"),o.createElement(n,{className:"mt-4",onResult:D,pause:u||!m,regExFormat:[r.studentName,r.studentId]})),o.createElement("div",{className:"mt-8 text-center font-bold"},"Scan your Student ID QR Code to Register",o.createElement("br",null),"Already registered? ",o.createElement("a",{href:"/login",className:"text-sky-500 hover:text-sky-300 hover:underline mt-2"},"Login")))):o.createElement("div",{className:"w-full pt-2 relative"},o.createElement("button",{type:"button",onClick:()=>window.location.replace("/"),className:"absolute top-0 left-0 ml-4 mt-4 text-sky-500 hover:text-sky-3 bg-white drop-shadow-lg pl-2 pr-3 py-1 rounded flex items-center"},o.createElement("span",{className:"material-symbols-outlined"},"arrow_left")," Home"),o.createElement("div",{className:"p-4"},o.createElement("form",{onSubmit:F,className:"max-w-md mx-auto flex flex-col gap-8 border border-sky-300 rounded-lg p-8 shadow-lg pt-10"},o.createElement(l,{className:"w-[100px] aspect-square mx-auto"}),o.createElement("div",{className:"text-[24px] font-[700] text-center"},"Student Registration"),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("input",{type:"text",className:"p-4 w-full border-2 border-gray-300 rounded-lg",placeholder:"Student ID",value:c,disabled:!0,required:!0})),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("input",{type:"text",className:"p-4 w-full border-2 border-gray-300 rounded-lg",placeholder:"Full Name",value:d,disabled:!0,required:!0})),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("input",{type:"email",className:"p-4 w-full border-2 border-gray-300 rounded-lg",placeholder:"Email Address",value:f,onChange:e=>g(e.target.value),required:!0})),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("select",{value:w,onChange:e=>E(e.target.value),title:"Department",className:"p-4 w-full border-2 border-gray-300 rounded-lg bg-sky-50",required:!0},o.createElement("option",{value:""},"-- Select Department --"),Object.entries(t).map((([e,t])=>o.createElement("option",{key:e,value:t},t))))),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("select",{value:v,onChange:e=>N(e.target.value),title:"Course",className:"p-4 w-full border-2 border-gray-300 rounded-lg bg-sky-50",required:!0},o.createElement("option",{value:""},"-- Select Course --"),Object.entries(e).map((([e,t])=>o.createElement("option",{key:e,value:t},t))))),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("select",{value:C,onChange:e=>S(e.target.value),title:"Year",className:"p-4 w-full border-2 border-gray-300 rounded-lg bg-sky-50",required:!0},o.createElement("option",{value:""},"-- Select Year --"),Object.entries(a).map((([e,t])=>o.createElement("option",{key:e,value:t},"1"===t?"1st Year":"2"===t?"2nd Year":"3"===t?"3rd Year":"4th Year"))))),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("input",{type:"password",className:"p-4 w-full border-2 border-gray-300 rounded-lg"+(q.password?" border-red-500":""),placeholder:"Password",value:x,onChange:e=>{b(e.target.value),_({password:""})},required:!0})),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("input",{type:"password",className:"p-4 w-full border-2 border-gray-300 rounded-lg",placeholder:"Repeat Password",value:y,onChange:e=>{h(e.target.value),_({password:""})},required:!0})),o.createElement("div",{className:"flex justify-center px-4"},o.createElement("button",{type:"submit",disabled:k||R,className:"bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 text-[22px] w-full disabled:bg-gray-300"},k?o.createElement("span",{className:"animate-pulse"},"Loading..."):o.createElement(o.Fragment,null,"Register")))),o.createElement("div",{className:"mt-8 text-center font-bold"},"Complete your registration with the details above",o.createElement("br",null),o.createElement("a",{href:"/signup",className:"text-sky-500 hover:text-sky-300 hover:underline mt-2"},"or Scan QR Code again if is not your Student ID"))))}export default i;