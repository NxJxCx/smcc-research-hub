import{IDRegExFormat as e}from"/jsx/global/enums";import{React as t,Sweetalert2 as a}from"/jsx/imports";import o from"/jsx/qrscan";function n(){const n=t.useMemo((()=>new URLSearchParams(window.location.search)),[window.location.search]),{student_id:r}=t.useMemo((()=>({student_id:n.get("student_id"),full_name:n.get("full_name")})),[n]),[l,s]=t.useState(!1),[c,i]=t.useState(!1),[m,u]=t.useState(r),[d,p]=t.useState(""),[g,x]=t.useState(!1),f=t.useCallback(((e,t)=>{t&&(i(!0),console.log("Student ID scanned: "+t),fetch(`/api/student?q=exist&id=${t}`).then((e=>e.json())).then((({error:o,exists:n})=>{o?a.fire({icon:"error",title:"Error",text:"Failed to check student existence: "+o}):n?(u(t),s(!1)):window.location.href=`/signup?student_id=${t}&full_name=${e}`})).catch((e=>{a.fire({icon:"error",title:"Error",text:"Failed to retrieve student information:"+e.message,toast:!0,showConfirmButton:!1,position:"top",timer:3e3})})).finally((()=>setTimeout((()=>i(!1)),1e3))))}),[]),h=t.useCallback((e=>{e.preventDefault(),x(!0),fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},body:JSON.stringify({account:"student",username:m,password:d})}).then((e=>e.json())).then((({error:e,success:t})=>{e?(a.fire({icon:"error",title:e,toast:!0,showConfirmButton:!1,position:"top",timer:3e3}),console.log(e)):t&&window.location.replace("/")})).catch((e=>{a.fire({icon:"error",title:"Error",text:"Failed to login. Please try again.",toast:!0,showConfirmButton:!1,position:"top",timer:3e3}),console.log(e)})).finally((()=>{p(""),x(!1)}))}),[m,d]),b=t.useMemo((()=>t.createElement("img",{src:"/images/SMCC-logo.svg",alt:"SMCC Logo",className:"w-[100px] aspect-square mx-auto"})),[]);return l?t.createElement("div",{className:"w-full pt-16"},t.createElement("div",{className:"p-4"},t.createElement("div",{className:"max-w-md mx-auto flex flex-col gap-8 border border-sky-300 rounded-lg p-8 shadow-lg pt-10"},b,t.createElement("div",{className:"text-[24px] font-[700] text-center"},"Student Login"),t.createElement(o,{className:"mt-4",onResult:f,pause:c||!l,regExFormat:[e.studentName,e.studentId]})),t.createElement("div",{className:"mt-8 text-center font-bold"},"Scan your Student ID QR Code",t.createElement("br",null),t.createElement("button",{type:"button",className:"text-sky-500 hover:text-sky-300 hover:underline mt-2",onClick:()=>s(!1)},"or Login with your Student ID")))):t.createElement("div",{className:"w-full pt-16"},t.createElement("div",{className:"p-4"},t.createElement("form",{onSubmit:h,className:"max-w-md mx-auto flex flex-col gap-8 border border-sky-300 rounded-lg p-8 shadow-lg pt-10"},b,t.createElement("div",{className:"text-[24px] font-[700] text-center"},"Student Login"),t.createElement("div",{className:"flex justify-center px-4"},t.createElement("input",{type:"text",className:"p-4 w-full border-2 border-gray-300 rounded-lg",placeholder:"Student ID",value:m,onChange:e=>u(e.target.value)})),t.createElement("div",{className:"flex justify-center px-4"},t.createElement("input",{type:"password",className:"p-4 w-full border-2 border-gray-300 rounded-lg",placeholder:"Password",value:d,onChange:e=>p(e.target.value)})),t.createElement("div",{className:"flex justify-center px-4"},t.createElement("button",{type:"submit",disabled:g,className:"bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 text-[22px] w-full disabled:bg-gray-300"},g?t.createElement("span",{className:"animate-pulse"},"Loading..."):t.createElement(t.Fragment,null,"Login"))),t.createElement("div",null,t.createElement("a",{href:"/signup",className:"text-sky-500 hover:text-sky-300 hover:underline pl-4"},"No Account? Register Now!"))),t.createElement("div",{className:"mt-8 text-center font-bold"},"Login with your Student ID",t.createElement("br",null),t.createElement("button",{type:"button",className:"text-sky-500 hover:text-sky-300 hover:underline mt-2",onClick:()=>s(!0)},"or Scan your Student ID QR Code"))))}export default n;